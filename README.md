# Форк SP_GMod, от https://github.com/kosmik641

# Добавлен новый функционал

# SP_GMod
### Скрипты для работы [Metrostroi](https://github.com/metrostroi-repo/MetrostroiAddon) с тренажером 81-717 (ООО "ПО "Зарница").

Библиотека работает с клиентом и не требует значительных модификаций на серверной стороне.

**`training_scripts`** - Папка аддона для Garry's Mod.  
**`uart_config`** - Папка для конфигурационных файлов. Хранится рядом с `hl2.exe`.  
**`GM_Zarnitsa`** - проект Premake с библиотекой Garry's Mod для работы с тренажером.  
**`Firmwares`** - дамп прошивок Universal CAN Controller v3.2 (STM32F103C8T6), в названии файла указан фактический порядковый номер контроллера. 

Использована библиотека [utf8_to_cp1251](https://github.com/bravikov/utf8_to_cp1251) (Распространяется по лицензии MIT)

# Установка 
Visual Studio 2022 версии 17.13.6 (возможно и новые версии подойдут)
Git (версия не важна)

1) Клонировать репозиторий https://github.com/kosmik641/SP_GMod
2) Скачать Premake5 https://premake.github.io/download/
3) Вставить скаченный Premake5.exe в папку SP_GMod\GM_Zarnitsa
4) Открыть командную строку, перейти в директорию SP_GMod\GM_Zarnitsa, ввести команду "premake5 --gmcommon="include/garrysmod_common" vs2022"
5) Открыть созданный Premake-ом файл .sln, собрать проект.
Если проект собрался, то в папке SP_GMod\GM_Zarnitsa\x86\Debug появится наш .dll

#Извесные проблемы при установке
Если при сборке найдены ошибки в файле driverspecs.h, то нужно перейти в директорию C:\Program Files (x86)\Windows Kits\10\Include\10.0.26100.0\shared (если не найдёт путь, нужно будет заменить "10.0.26100.0" на версию Windows SDK, которая установлена у вас), через блокнот, закомментировать строки с ошибкой (в моём случае строки 245-248) через Visual Studio не сработает, нужны права администратора

//Оригинальное описание
# Инициализация проекта
1. Скачать [Premake5](https://premake.github.io/download/)
2. Положить бинарный файл рядом с `premake5.lua`
3. Выполнить команду в папке проекта:
```
premake5 --gmcommon="include/garrysmod_common" vs2022
```
- Для Linux вместо `vs2022` необходимо ввести `gmake`

# Команды для работы с модулем TrainSignals
**Все команды выполняются в консоли клиента.**

`zarn_start [НОМЕР ПОРТА]` - Запуск работы модуля.  
`zarn_stop` - Остановка работы модуля.  
`zarn_force_stop` - Принудительная остановка работы модуля без деконфигурации. 
`zarn_reload [ВЫВОД ИНФОРМАЦИИ]` - Перезагрузка конфигурации (только при остановленной работе модуля!).  

